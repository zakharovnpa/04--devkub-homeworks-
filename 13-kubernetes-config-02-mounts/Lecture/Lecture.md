### Лекция по теме "13.2 Разделы и монтирование"

Андрей
Копылов

### 1Андрей Копылов
TechLead
PremiumBonus

### 2План занятия
1. Терминология
2. Возможности
3. Отличия от Docker
4. Типы хранилищ
5. Применения
6. Итоги
7. Домашнее задание

### 3Терминология
- Volume (том) — директория, хранящаяся за пределами подов.
- Persistent Volume (PV) — внешнее хранилище, подключаемое к контейнерам.
Не обеспечивает сохранение данных при перезагрузке пода
- StorageClass — динамически создает PV. Некий алиас к провижионеру.  Это то, что обеспечивает предоставление некоторых объектов и ресурсов, в том числе  Persistent Volume Claim (PVC). 
- Persistent Volume Claim (PVC) — элемент для связи подов и PV. Будем рассматривать на следующем занятии.

### 4Возможности
- позволяет хранить данные в файловой системе ноды / внешнем хранилище;
- поддерживает различные реализации хранилища;
- может ограничивать доступ (чтение/запись для
одного/нескольких подов);

Кубер хорош для запуска стейт-лесс приложений. Они не нуждаются в сохранении своего состояния в файловой системе. Для работы БД рекомендуется хранить ее за пределами кластера Кубернетес. Кубер вносит свои задержки по сети. Однако есть такие вещи, как Прометеус и в целом его можно размещать в файловой системе но его надо подклчать для доступа наружу. Можно хранить на отдельной ноде. Но это не очень надежно. Кубер построен нато, что не жалко потерять одну ноду - все будет работать и дальше. НО если вам даные нужны после преезаупска, то мы их потеряем. Также есть такие режимы запуска - не договорил!!

### 5Отличия от Docker Volumes
- В докере: локальные папки и реже nfs.
- В kubernetes: PV — это интерфейс, за ним может быть
и внешнее хранилище на блочном устройстве или
облако.

Нет необходимости использовать некие провижионеры. В Кубере все несколько иначе, особенно что касается в качестве постоянного хранилища. В Докере примонитровал папку - и все - выподключились к ней. В Кубере есть волюмы и персистем волюмы. СОжет храниться на разных хранилищах.

- Сейчас мы будем проговариватть про Контейнер интерфейс CSI  - не точно записал

### 6EmptyDir
- применяется для создания общей папки в поде;
- у каждого пода своя папка;
- при перезапуске создается заново.

Это один из сторадже интерфейсов. Это временное хранение. Можно примонитровать каждый контейнер в свою папку, но при перезапуске пода в этой папке ничего не будет сохранено. Можно обмениваться файлами между подами и контейнерами.

- В Кубере может быть внесено много кастомных ресурсов. При их появлени Кубер запустит с помощью Контролер менеджера и он вам запустит то, чего ранбше не было.

### 7Persistent Volume Claim
- нужен для подключения внешнего постоянного хранилища;
- можно называть запросом на хранилище;
- описывает минимальные требования к хранилищу;
- после подключения к тому доступен для подов;
- описывает принцип работы после отключения —
удаление, очистка, сохранение данных.

- Это заявка на создание тома PVC. Мы создаем этот пивиси, в заявке указывается минимальное требование к хранилищу, но может быть предоставлен меньшего размера. После подключения может быть доступен для подов.

### 8Схема PVC
![shema-pvc](/13-kubernetes-config-02-mounts/Files/shema-pvc.png)

Для того, что бы создался под. Разраб хочет получить волюм какого-то размер. НО под не сможе тзапуститься, пока этот персистем волюм не создаться и причем нужного размера и подходящим по режимам доступа. В каких-то старых версия адми и был тем, кто создавал волюмы.  С помощью объекта   PVCбудет произведена связка и PVC соединится с подом.

### 9Persistent Volume
- может быть несколько в кластере;
- можно создавать динамически через StorageClass;
- доступны различные плагины для хранилищ.

- Постоянное хранилище. Их в кластере может быть много. Их может создаавть админ или автоавтически.

-  NFS не самое быстрое хранилище. Прометеус на нем запускать - плохая идея. Длч некритических данных можно использовать недорогие хранилища. 
-  PV 
-  

### 10Persistent Volume: local
- подключает локальную папку с текущей ноды;
- на каждой ноде будет создана своя папка;
- лучше всего применять совместно со statefulset.

- РАзумно предположить, что может использоваться с Демонсетами, они запущены на кождой из нод.
- Надо следить за наличием свободного места на нолде, но решение рабочее.

### 11Persistent Volume: nfs
- подключает внешнюю папку к ноде, а ее — в под;
- можно создать общий сервер и подключать в
кластер;
- нужно учитывать передачу данных по сети.

- 

### 12Persistent Volume: CephFS
- внешний кластер можно запустить как угодно;
- работает быстрее nfs;
- можно подключить общую папку ко множеству подов.

![cephfs](/13-kubernetes-config-02-mounts/Files/cephfs.png)



### 13Persistent Volume: облачные решения
- можно использовать готовые решения от облаков;
- каждое облако имеет готовые плагины:
awsElasticBlockStore, gcePersistentDisk, azureDisk;
- упрощает работу с хранилищами в кластерах.

### 14Когда применять
- хранить состояние базы данных; - Тогда, когда используем БД для тестовых решений, где высокая производительность не очень нужна.
- шарить статику сайта; например, картинки, постоянные какие-то данные
- хранить общие логи и собирать;
- передавать файлы между подами.

- 00:30:00 - Практическая часть лекции

### 15Итоги
Сегодня мы изучили:
- из чего состоит хранилище в Kubernetes;
- какие решения можно применять;
- когда стоит применять внешние тома.

### 16Домашнее задание
Давайте посмотрим ваше домашнее задание.
- Вопросы по домашней работе задавайте в чате мессенджера
Slack.
- Задачи можно сдавать по частям.
- Зачёт по домашней работе проставляется после того, как приняты
все задачи.

### 17Задавайте вопросы и
пишите отзыв о лекции!
Андрей Копылов
