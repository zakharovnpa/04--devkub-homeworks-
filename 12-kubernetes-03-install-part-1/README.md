# Домашнее задание к занятию "12.3 Развертывание кластера на собственных серверах, лекция 1" - Захаров Сергей Николаевич
Поработав с персональным кластером, можно заняться проектами. Вам пришла задача подготовить кластер под новый проект.

## Задание 1: Описать требования к кластеру
Сначала проекту необходимо определить требуемые ресурсы. Известно, что проекту нужны база данных, система кеширования, а само приложение состоит из бекенда и фронтенда. Опишите, какие ресурсы нужны, если известно:

* База данных должна быть отказоустойчивой. Потребляет 4 ГБ ОЗУ в работе, 1 ядро. 3 копии.
* Кэш должен быть отказоустойчивый. Потребляет 4 ГБ ОЗУ в работе, 1 ядро. 3 копии.
* Фронтенд обрабатывает внешние запросы быстро, отдавая статику. Потребляет не более 50 МБ ОЗУ на каждый экземпляр, 0.2 ядра. 5 копий.
* Бекенд потребляет 600 МБ ОЗУ и по 1 ядру на копию. 10 копий.

План расчета
1. Сначала сделайте расчет всех необходимых ресурсов.
2. Затем прикиньте количество рабочих нод, которые справятся с такой нагрузкой.
3. Добавьте к полученным цифрам запас, который учитывает выход из строя как минимум одной ноды.
4. Добавьте служебные ресурсы к нодам. Помните, что для разных типов нод требовния к ресурсам разные.
5. Рассчитайте итоговые цифры.
6. В результате должно быть указано количество нод и их параметры.


**Ответ:**
### Пояснение к решению
> Требуется развернуть кластер Kubernetes. 
> Логи и результаты моиторинга отправляются на систему мониторнга, не установленную на рассматриваемом кластере.
1. Составим таблицу известных ресурсов для одной копии каждой системы

##### Таблица1. Расчетные необходимые ресурсы каждой системы
Система|CPU, шт|ОЗУ, Гб|HDD, Гб
|-|-|-|-|
БД|6|12|В задании X. Примем Х=20
Кеширование|9|12|В задании X. Примем Х=20
Фронтенд|1|0.25|В задании X. Примем Х=1
Бэкенд|10|6|В задании X. Примем Х=3
**Итого**|26|30,25|44

### 1. Планирование кол-во нод, которые могут справиться с такой нагрузкой
1. Рассчитаем состав и необходимые ресурсы для каждого физического сервера, на котором будет запускаться одна из нод кластера согласно условий:
  * Исходя из необходимости разместить три копии БД и три копии кэша на рзных "физичесикх площадках", а также необходимость разместить Мастер-ноду на отдельной "физической площадке", будем использовать 4 физических сервера (или 4 виртуальных сервера) в различных географических регионах (регионах облачного провайдера). Назовем каждую такую "физическую площадку" "хост-системой"
2. На каждой из хост-систем запускается одна нода кластера Kubernetis
##### Таблица 2. Распределение подов систем на различных нодах
Система|Worker node 1, шт.|Worker node 2, шт.|Worker node 3, шт.|Control plane, шт.
|-|:-:|:-:|:-:|:-:|
БД|1|1|1||
Кэш|1|1|1||
Фронтенд|2|2|1||
Бекенд|3|3|4||
ПО для мониторинга|1|1|1|1
ПО для сбор логов|1|1|1|1

###  2. Добавляем коэффицмент запаса, который учитывает выход из строя как минимум одной ноды.

1. Вводим коэффициент резервирования - "К. рез" из расчета, что если одна нода из трех работающих выйдет из строя, ее нагрузку возьмут на себя оставшиеся две работающие ноды.
* К. рез = 1,5

### 3. Расчет необходимых ресурсов. 
1. Определение дисковых ресурсов для всех копий систем.

##### Таблица 3. Потребные дисковые ресурсы всех копий систем
Система|Для 1 копии, Гб|К, рез|Всего для 1 копии, Гб|Кол-во копий, шт.|Итого, Гб
|-|:-:|:-:|:-:|:-:|:-:|
БД|20|1,5|30|3|90
Кеширование|20|1,5|30|3|90
Фронтенд|1|1,5|1,5|5|7,5
Бэкенд|3|1,5|4,5|10|45
**Итоги расчета, Гб**|||||**232,5**

2. Определение количества CPU для всех рабочих копий
##### Таблица 4. Количество CPU для всех копий
Система|Для 1 копии, шт.|К, рез|Всего для 1 копии, шт.|Кол-во копий, шт.|Итого, шт.
|-|:-:|:-:|:-:|:-:|:-:|
БД|4|1,5|6|3|18
Кеширование|1|1,5|1,5|3|4,5
Фронтенд|1|1,5|1,5|5|7,5
Бэкенд|1|1,5|1,5|10|15
**Итоги расчета, шт.**|||||**45**

3. Определение объема ОЗУ ддля всех рабочих копий
##### Таблица 5. Объем ОЗУ для всех копий
Система|Для 1 копии, Гб|К, рез|Всего для 1 копии, Гб|Кол-во копий, шт|Итого, Гб
|-|:-:|:-:|:-:|:-:|:-:|
БД|4|1,5|6|3|18
Кеширование|4|1,5|6|3|18
Фронтенд|0,05|1,5|0,075|5|0,375
Бэкенд|0,6|1,5|0,9|10|9
**Итоги расчета, Гб**|||||**45,375**

### 4. Добавляем служебные ресурсы для работы хостовой системы.

1. Расчет ресурсов каждого хоста

##### Таблица 6. Количество ресурсов для одной хост-системы с одной Control node
Система|Размер HDD, Гб|Кол-во CPU, шт.|Кол-во ОЗУ, Гб
|-|:-:|:-:|:-:|
Control node|50|2|2
Операционная система|10|1|1
Мониторинг|20|1|1
Логирование|10|1|1
Итоги рассчета, Гб|90|5|5

##### Таблица 7. Количество ресурсов для одной хост-системы с одной рабочей нодой
Система|Размер HDD, Гб|Кол-во CPU, шт.|Кол-во ОЗУ, Гб
|-|:-:|:-:|:-:|
Рабочая нода|100|1|1
Операционная система|10|1|1
Мониторинг|20|1|1
Логирование|10|1|1
Итоги рассчета, Гб|140|4|4

### 5. Рассчет итоговых цифр. В результате указано количество нод и их параметры.
##### Таблица 8. Распределение ресурсов по различным нодам кластера
Ресурс|Worker node 1|Worker node 2|Worker node 3|Control node| **Итого:**
|-|:-:|:-:|:-:|:-:|:-:|
CPU, шт.|20|20|20|5|**65**
ОЗУ, Гб|14|14|14|5|**47**
HDD, Гб|276,5|276,5|276,5|150|**979,5**


## Как оформить ДЗ?

Выполненное домашнее задание пришлите ссылкой на .md-файл в вашем репозитории.
