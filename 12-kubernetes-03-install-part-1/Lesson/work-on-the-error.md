# Работа над ошибками по ДЗ к занятию "12.3 Развертывание кластера на собственных серверах, лекция 1" - Захаров Сергей Николаевич
Поработав с персональным кластером, можно заняться проектами. Вам пришла задача подготовить кластер под новый проект.

## Задание 1: Описать требования к кластеру
Сначала проекту необходимо определить требуемые ресурсы. Известно, что проекту нужны база данных, система кеширования, а само приложение состоит из бекенда и фронтенда. Опишите, какие ресурсы нужны, если известно:

* База данных должна быть отказоустойчивой. Потребляет 4 ГБ ОЗУ в работе, 1 ядро. 3 копии.
* Кэш должен быть отказоустойчивый. Потребляет 4 ГБ ОЗУ в работе, 1 ядро. 3 копии.
* Фронтенд обрабатывает внешние запросы быстро, отдавая статику. Потребляет не более 50 МБ ОЗУ на каждый экземпляр, 0.2 ядра. 5 копий.
* Бекенд потребляет 600 МБ ОЗУ и по 1 ядру на копию. 10 копий.

План расчета
1. Сначала сделайте расчет всех необходимых ресурсов.
2. Затем прикиньте количество рабочих нод, которые справятся с такой нагрузкой.
3. Добавьте к полученным цифрам запас, который учитывает выход из строя как минимум одной ноды.
4. Добавьте служебные ресурсы к нодам. Помните, что для разных типов нод требовния к ресурсам разные.
5. Рассчитайте итоговые цифры.
6. В результате должно быть указано количество нод и их параметры.


**Ответ:**
### Пояснение к решению
> Требуется развернуть кластер Kubernetes. 
> Логи и результаты мониторинга отправляются на систему мониторнга, не установленную на рассматриваемом кластере.
1. Составим таблицу известных ресурсов для одной копии каждой системы

##### Таблица 1. Расчетные необходимые ресурсы каждой системы для одной копии
Система|CPU, шт|ОЗУ, Гб|HDD, Гб
|-|-|-|-|
БД|1|4|В задании X. Примем Х=20
Кеширование|1|4|В задании X. Примем Х=20
Фронтенд|0,2|0,05|В задании X. Примем Х=1
Бэкенд|1|0,6|В задании X. Примем Х=3

### 1. Планирование кол-во нод, которые могут справиться с такой нагрузкой
1. Рассчитаем состав и необходимые ресурсы для каждого физического сервера, на котором будет запускаться одна из нод кластера согласно условий:
  * Исходя из необходимости разместить три копии БД и три копии кэша на рзных "физичесикх площадках", а также необходимость разместить Мастер-ноду на отдельной "физической площадке", будем использовать 4 физических сервера (или 4 виртуальных сервера) в различных географических регионах (регионах облачного провайдера). Назовем каждую такую "физическую площадку" "хост-системой"
2. На каждой из хост-систем запускается одна нода кластера Kubernetis
##### Таблица 2. Распределение подов систем на различных нодах
Система|Worker node- 1, шт.|Worker node-2, шт.|Worker node-3, шт.|Control plane, шт.
|-|:-:|:-:|:-:|:-:|
БД|1|1|1||
Кэш|1|1|1||
Фронтенд|2|2|1||
Бекенд|3|3|4||
ПО для мониторинга|1|1|1|1
ПО для сбор логов|1|1|1|1

###  2. Добавляем коэффицbент запаса, который учитывает выход из строя, как минимум, одной ноды.

1. Вводим коэффициент резервирования - "К. рез" из расчета, что если одна нода из трех работающих выйдет из строя, ее нагрузку возьмут на себя оставшиеся две работающие ноды.
* К. рез = 1,5

### 3. Расчет необходимых ресурсов ля каждой ноды кластера. 
1. Определение ресурсов для ноды "Worker node-1".

##### Таблица 3. Потребные дисковые ресурсы всех систем ноды "Worker node-1"
Система|Кол-во копий|CPU, шт.| RAM, Гб| HDD, Гб
|-|:-:|:-:|:-:|:-:|
БД|1|1|4|20
Кеширование|1|1|4|20
Фронтенд|2|0,4|0,1|1
Бэкенд|3|3|1,8|9
Всего:||5,4|9,9|50
**Итого с учетом К рез.=1,5**||**8,1**|**14,85**|**75**

2. Определение ресурсов для ноды "Worker node-2".

##### Таблица 4. Потребные дисковые ресурсы всех систем ноды "Worker node-2"
Система|Кол-во копий|CPU, шт.| RAM, Гб| HDD, Гб
|-|:-:|:-:|:-:|:-:|
БД|1|1|4|20
Кеширование|1|1|4|20
Фронтенд|2|0,4|0,1|1
Бэкенд|3|3|1,8|9
Всего:||5,4|9,9|50
**Итого с учетом К рез.=1,5**||**8,1**|**14,85**|**75**

3. Определение ресурсов для ноды "Worker node-3".

##### Таблица 5. Потребные дисковые ресурсы всех систем ноды "Worker node-3"
Система|Кол-во копий|CPU, шт.| RAM, Гб| HDD, Гб
|-|:-:|:-:|:-:|:-:|
БД|1|1|4|20
Кеширование|1|1|4|20
Фронтенд|1|0,2|0,05|1
Бэкенд|4|4|2,4|12
Всего:||6,2|10,45|53
**Итого с учетом К рез.=1,5**||**9,3**|**15,675**|**79,5**

### 4. Добавляем служебные ресурсы для работы хостовой системы.

1. Расчет общесистемных ресурсов каждого хоста.

##### Таблица 6. Количество общесистемных ресурсов для одной хост-системы
Система|Кол-во CPU, шт.|Кол-во RAM, Гб|Размер HDD, Гб
|-|:-:|:-:|:-:|
Операционная система|1|1|10
Мониторинг|1|1|20
Логирование|1|1|10
**Итого:**|**3**|**3**|**40**

2. Расчет кластерных ресурсов каждого хоста. Учитывается инсталляция компонентов Kubernetes.
##### Таблица 7. Количество кластерных ресурсов для одной хост-системы 
Система|Кол-во CPU, шт.|Кол-во RAM, Гб|Размер HDD, Гб
|-|:-:|:-:|:-:|
Control node|2|2|50
Рабочая нода|1|1|100
**Итого:**|**3**|**3**|**150**

### 5. Рассчет итоговых цифр. В результате указано количество нод и их полные параметры необходимых ресурсов.
##### Таблица 8. Распределение ресурсов на ноде "Worker node-1"
Система|Кол-во CPU, шт.|Кол-во RAM, Гб|Размер HDD, Гб
|-|:-:|:-:|:-:|
Система|8,1|14,85|75
Worker node|1|1|100
Общесистемные|3|3|40
**Итого:**|**12,1**|**18,85**|**215**

##### Таблица 9. Распределение ресурсов на ноде "Worker node-2"
Система|Кол-во CPU, шт.|Кол-во RAM, Гб|Размер HDD, Гб
|-|:-:|:-:|:-:|
Система|8,1|14,85|75
Worker node|1|1|100
Общесистемные|3|3|40
**Итого:**|**12,1**|**18,85**|**215**

##### Таблица 10. Распределение ресурсов на ноде "Worker node-3"
Система|Кол-во CPU, шт.|Кол-во RAM, Гб|Размер HDD, Гб
|-|:-:|:-:|:-:|
Система|9,3|15,675|79,5
Worker node|1|1|100
Общесистемные|3|3|40
**Итого:**|**13,3**|**19,675**|**219,5**

##### Таблица 11. Распределение ресурсов на ноде "Worker node-4"
Система|Кол-во CPU, шт.|Кол-во RAM, Гб|Размер HDD, Гб
|-|:-:|:-:|:-:|
Control node|1|1|100
Общесистемные|3|3|40
**Итого:**|**12,1**|**18,85**|**215**



##### Таблица 8. Распределение ресурсов по различным нодам кластера
Ресурс|Worker node 1|Worker node 2|Worker node 3|Control node| **Итого:**
|-|:-:|:-:|:-:|:-:|:-:|
CPU, шт.|20|20|20|5|**65**
ОЗУ, Гб|14|14|14|5|**47**
HDD, Гб|276,5|276,5|276,5|150|**979,5**


## Как оформить ДЗ?

Выполненное домашнее задание пришлите ссылкой на .md-файл в вашем репозитории.
