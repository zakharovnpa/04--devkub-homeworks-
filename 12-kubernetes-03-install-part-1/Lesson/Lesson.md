## Ход выполнения ДЗ по теме "12.3 Развертывание кластера на собственных серверах, лекция 1"
Поработав с персональным кластером, можно заняться проектами. Вам пришла задача подготовить кластер под новый проект.

## Задание 1: Описать требования к кластеру
Сначала проекту необходимо определить требуемые ресурсы. Известно, что проекту нужны база данных, система кеширования, а само приложение состоит из бекенда и фронтенда. Опишите, какие ресурсы нужны, если известно:

* База данных должна быть отказоустойчивой. Потребляет 4 ГБ ОЗУ в работе, 1 ядро. 3 копии.
* Кэш должен быть отказоустойчивый. Потребляет 4 ГБ ОЗУ в работе, 1 ядро. 3 копии.
* Фронтенд обрабатывает внешние запросы быстро, отдавая статику. Потребляет не более 50 МБ ОЗУ на каждый экземпляр, 0.2 ядра. 5 копий.
* Бекенд потребляет 600 МБ ОЗУ и по 1 ядру на копию. 10 копий.

План расчета
1. Сначала сделайте расчет всех необходимых ресурсов.
2. Затем прикиньте количество рабочих нод, которые справятся с такой нагрузкой.
3. Добавьте к полученным цифрам запас, который учитывает выход из строя как минимум одной ноды.
4. Добавьте служебные ресурсы к нодам. Помните, что для разных типов нод требовния к ресурсам разные.
5. Рассчитайте итоговые цифры.
6. В результате должно быть указано количество нод и их параметры.

**Ответ:**
Требуется развернуть кластер Kubernetes. 
Рассчитаем состав и необходимые ресурсы для физических серверов и для каждой из нод согласно условий:
* Используется один физический или виртуальный сервер. Называется "хост-система"
* Используется 9 виртуальных систем. 
  * Одна для мастер-ноды. 
  * Три для рабочих нод с БД. 
  * Три для рабочих нод с кэш. 
  * Одна для рабочей ноды с бэкендом. 
  * Одна для рабочей ноды с фронтендом.
* Необходимо обеспечить отказоустойчивость БД и кэшу. Для этого используем три ноды для БД и три ноды для кэша.
* На мастер-ноде будет установлено:
  * Kubeadm, Kubectl, etcd
  * прикладное ПО (какое?)
* На каждой рабочей ноде будет установлено:
  * Kube-proxy, kubelet 
  * Приложение для БД в виде микросервиса
  * Приложение для кэша в виде микросервиса


1. Составим таблицу необходимых ресурсов

#### Известное кол-во ресурсов для одной копии каждой системы
Система|Кол-во копий|CPU, шт|ОЗУ, Гб|HDD, Гб
|-|-|-|-|-|
БД|3|6|12|60
Кеширование|3|9|12|X
Фронтенд|5|1|0.25|X
Бэкенд|10|10|6|X
**Итого**||40|40|X

2. Составим таблицу необходимых ресурсов для нод кластера

Тип ноды|CPU, шт|ОЗУ, Гб|HDD, Гб
|-|-|-|-|
Мастер нода|2|2|50
Рабочей ноды|1|1|100

* Вводим коэффициент резервирования - "К. рез" из расчета, что если одна нода выйдет из строя, ее нагрузку возьмут на себя оставшиеся две ноы.
* К. рез= 1,5

3. Расчет дисковых ресурсов одной ноды кластера

Система|Для 1 ноды, Гб|Кол-во нод, Гб|Всего, Гб|К, рез|Итого, Гб
|-|-|-|-|-|-|
БД|20|3|60|1,5|90
Кеширование|20|3|60|1,5|90
Фронтенд|1|5|5|1,5|7,5
Бэкенд|3|10|30|1,5|45
Итог рассчета, Гб|||||232,5

4. Рассчет количества ядер CPU для одной ноды кластера

Система|Для 1 ноды, шт.|Кол-во нод, шт.|Всего, шт.|К, рез|Итого, шт.
|-|-|-|-|-|-|
БД|4|3|12|1,5|18
Кеширование|1|3|3|1,5|4,5
Фронтенд|1|5|5|1,5|7,5
Бэкенд|1|10|10|1,5|15
Итог рассчета, шт.|||||45

5. Рассчет количества ОЗУ для одной ноды кластера

Система|Для 1 ноды, Гб|Кол-во нод, шт|Всего, Гб|К, рез|Итого, Гб
|-|-|-|-|-|-|
БД|4|3|12|1,5|18
Кеширование|4|3|12|1,5|18
Фронтенд|0,05|5|0,25|1,5|0,375
Бэкенд|0,6|10|6|1,5|9
Итог рассчета, Гб|||||45,375


### Расчет ресурсов для работы хостовой системы

1. Расчет дисковых ресурсов хоста

Система|Для 1 ноды, Гб|Кол-во нод, шт|Итого, Гб
|-|-|-|-|
Мастер нода|50|3|150
Рабочая нода|100|3|300
Операционная система|20|3|60
Итог рассчета, Гб|||510

2. Рассчет количества ядер CPU для хоста

Система|Для 1 ноды, шт.|Кол-во нод, шт.|Итого, шт.
|-|-|-|-|
Мастер нода|2|3|6
Рабочая нода|1|3|3
Операционная система|1|1|1
Прикладное ПО|1|1|1
Итог рассчета, шт.|||11

3. Рассчет количества ОЗУ для хоста

Система|Для 1 ноды, Гб|Кол-во нод, шт|Итого, Гб
|-|-|-|-|
Мастер нода|2|3|6
Рабочая нода|1|3|3
Операционная система|1|1|1
Прикладное ПО|2|1|2
Итог рассчета, Гб|||12


### Рассчет итоговых цифр. В результате должно быть указано количество нод и их параметры.

* Для развертывания кластера необходимв следующие ресурсы:
  * Мастер нода - 1
  * Рабочая нода - 3
  * Хостовый сервер - 1

 -|Нода|Хост-система|Итого
|-|-|-|-|
CPU, шт.| 45 | 11 |  56
ОЗУ, Гб| 45,375 | 12 |  58
HDD, Гб| 232,5 | 510 |  740

* Кол-во CPU - 56 шт.
* Размер ОЗУ - 58 Гб.
* Размер дисковой подсистемы - 740 Гб.





#### Полезные ссылки:

[Привет, Minikube](https://kubernetes.io/ru/docs/tutorials/hello-minikube/#%D1%81%D0%BE%D0%B7%D0%B4%D0%B0%D0%BD%D0%B8%D0%B5-%D0%BA%D0%BB%D0%B0%D1%81%D1%82%D0%B5%D1%80%D0%B0-minikube)

[Deployments](https://kubernetes.io/docs/concepts/workloads/controllers/deployment/)

[Установка Minikube](https://kubernetes.io/ru/docs/tasks/tools/install-minikube/)

[Установка Kubernetes с помощью Minikube](https://kubernetes.io/ru/docs/setup/learning-environment/minikube/)

[Установка и настройка kubectl](https://kubernetes.io/ru/docs/tasks/tools/install-kubectl/)


[Пользователи и авторизация RBAC в Kubernetes](https://habr.com/ru/company/flant/blog/470503/)

[Азбука безопасности в Kubernetes: аутентификация, авторизация, аудит](https://habr.com/ru/company/flant/blog/468679/)

[Установка среды выполнения контейнера](https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/install-kubeadm/)

[кри-докерд](https://github.com/Mirantis/cri-dockerd)

[Migrate Docker Engine nodes from dockershim to cri-dockerd](https://kubernetes.io/docs/tasks/administer-cluster/migrating-from-dockershim/migrate-dockershim-dockerd/)

[CRI-O — альтернатива Docker для запуска контейнеров в Kubernetes](https://habr.com/ru/company/flant/blog/340010/)

[Использование авторизации RBAC](https://kubernetes.io/docs/reference/access-authn-authz/rbac/#referring-to-resources)

[Как изменить пользователей в kubectl?](https://stackoverflow.com/questions/61462892/how-to-change-users-in-kubectl)

[Руководство по Kubernetes, часть 2: создание кластера и работа с ним](https://habr.com/ru/company/ruvds/blog/438984/)

## Как оформить ДЗ?

Выполненное домашнее задание пришлите ссылкой на .md-файл в вашем репозитории.


