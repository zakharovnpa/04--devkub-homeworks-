## Ход выполнения ДЗ по теме "12.3 Развертывание кластера на собственных серверах, лекция 1"
Поработав с персональным кластером, можно заняться проектами. Вам пришла задача подготовить кластер под новый проект.

## Задание 1: Описать требования к кластеру
Сначала проекту необходимо определить требуемые ресурсы. Известно, что проекту нужны база данных, система кеширования, а само приложение состоит из бекенда и фронтенда. Опишите, какие ресурсы нужны, если известно:

* База данных должна быть отказоустойчивой. Потребляет 4 ГБ ОЗУ в работе, 1 ядро. 3 копии.
* Кэш должен быть отказоустойчивый. Потребляет 4 ГБ ОЗУ в работе, 1 ядро. 3 копии.
* Фронтенд обрабатывает внешние запросы быстро, отдавая статику. Потребляет не более 50 МБ ОЗУ на каждый экземпляр, 0.2 ядра. 5 копий.
* Бекенд потребляет 600 МБ ОЗУ и по 1 ядру на копию. 10 копий.

План расчета
1. Сначала сделайте расчет всех необходимых ресурсов.
2. Затем прикиньте количество рабочих нод, которые справятся с такой нагрузкой.
3. Добавьте к полученным цифрам запас, который учитывает выход из строя как минимум одной ноды.
4. Добавьте служебные ресурсы к нодам. Помните, что для разных типов нод требовния к ресурсам разные.
5. Рассчитайте итоговые цифры.
6. В результате должно быть указано количество нод и их параметры.

**Ответ:**

1. Требуется развернуть кластер Kubernetes. 
Рассчитаем состав и необходимые ресурсы для каждого физического сервера, на котором будет запускаться одна из нод кластреа согласно условий:
* Используется 4 физических сервера или 4 виртуальных сервера в различных регионах облачного провайдера, Называемых "хост-система"
* На каждой из хост-систем запускается одна нода кластера Kubernetis
  * На первой ноде - Control plane (мастер нода)
  * На второй, третьей и четвертой ноде - Worker node (рабочая нода) 
2. Для обеспечения отказоустойчивости используем:
* На первой рабочей ноде: 
  * три пода с БД
  * три пода с кеэш
  * пять подов с Фронтенд
  * 10 подов с Бекенд
3. На мастер-ноде будет установлено:
  * Kubeadm, Kubectl, etcd
  * Прикладное ПО для мониторинга
  * Прикладное ПО для сбор логов
4. На каждой рабочей ноде будет установлено:
  * Kube-proxy, kubelet 
  * Приложение для БД в виде микросервиса
  * Приложение для кэша в виде микросервиса
  * Приложение для Фронтэнда
  * Приложение для Бэкэнда
  * Прикладное ПО для мониторинга
  * Прикладное ПО для сбор логов
5. Логи и результаты моиторинга отправляются на систему мониторнга, не установленную на рассматриваемом кластере.


1. Составим таблицу известных минимально необходимых ресурсов для одной копии каждой системы

##### Таблица1. Минимально необходимые ресурсы
Система|CPU, шт|ОЗУ, Гб|HDD, Гб
|-|-|-|-|
БД|6|12|В задании X. Примем Х=20
Кеширование|9|12|В задании X. Примем Х=20
Фронтенд|1|0.25|В задании X. Примем Х=1
Бэкенд|10|6|В задании X. Примем Х=3
**Итого**|26|30,25|44


2. Расчет дисковых ресурсов для всех рабочих нод
* Вводим коэффициент резервирования - "К. рез" из расчета, что если одна рабочая нода выйдет из строя, ее нагрузку возьмут на себя оставшиеся две рабочие ноы.
* К. рез = 1,5

##### Таблица 3. Потребные дисковые ресурсы всех копий систем
Система|Для 1 копии, Гб|К, рез|Всего для 1 копии, Гб|Кол-во копий, шт.|Итого, Гб
|-|:-:|:-:|:-:|:-:|:-:|
БД|20|1,5|30|3|90
Кеширование|20|1,5|30|3|90
Фронтенд|1|1,5|1,5|5|7,5
Бэкенд|3|1,5|4,5|10|45
**Итоги рассчета, Гб**|||||**232,5**

3. Рассчет количества ядер CPU для всех рабочих копий
##### Таблица 4. Количество CPU для всех копий
Система|Для 1 копии, шт.|К, рез|Всего для 1 копии, шт.|Кол-во копий, шт.|Итого, шт.
|-|:-:|:-:|:-:|:-:|:-:|
БД|4|1,5|6|3|18
Кеширование|1|1,5|1,5|3|4,5
Фронтенд|1|1,5|1,5|5|7,5
Бэкенд|1|1,5|1,5|10|15
**Итоги рассчета, шт.**|||||**45**

4. Рассчет количества ОЗУ ддля всех рабочих копий
##### Таблица 5. Количество ОЗУ для всех копий
Система|Для 1 копии, Гб|К, рез|Всего для 1 копии, Гб|Кол-во копий, шт|Итого, Гб
|-|:-:|:-:|:-:|:-:|:-:|
БД|4|1,5|6|3|18
Кеширование|4|1,5|6|3|18
Фронтенд|0,05|1,5|0,075|5|0,375
Бэкенд|0,6|1,5|0,9|10|9
**Итоги рассчета, Гб**|||||**45,375**



### Расчет ресурсов для работы хостовой системы

1. Расчет дисковых ресурсов хоста
##### Таблица 6. Количество дисковых ресурсов для одной хост-системы с одной рабочей нодой
Система|Для 1 ноды, Гб|Кол-во нод, шт|Итого, Гб
|-|:-:|:-:|:-:|
Рабочая нода|100|3|300
Операционная система|20|3|60
Итоги рассчета, Гб|||360

2. Рассчет количества CPU для хоста
##### Таблица 7. Количество CPU для одной хост-системы с одной рабочей нодой
Система|Для 1 ноды, шт.|Кол-во нод, шт.|Итого, шт.
|-|-|-|-|
Рабочая нода|1|3|3
Операционная система|1|1|1
Прикладное ПО|1|1|1
Итоги рассчета, шт.|||5

3. Рассчет количества ОЗУ для хоста
##### Таблица 8. Количество ОЗУ для одной хост-системы с одной рабочей нодой
Система|Для 1 ноды, Гб|Кол-во нод, шт|Итого, Гб
|-|-|-|-|
Рабочая нода|1|3|3
Операционная система|1|1|1
Прикладное ПО|2|1|2
Итоги рассчета, Гб|||8


### Рассчет итоговых цифр. В результате должно быть указано количество нод и их параметры.

* Для развертывания кластера необходимв следующие ресурсы:
  * Мастер нода - 1
  * Рабочая нода - 3
  * Хостовых серверов - 4
##### Таблица 9.
 -|Нода|Хост-система|Итого
|-|-|-|-|
CPU, шт.| 45 | 11 |  56
ОЗУ, Гб| 45,375 | 12 |  58
HDD, Гб| 232,5 | 510 |  740

* Кол-во CPU - 56 шт.
* Размер ОЗУ - 58 Гб.
* Размер дисковой подсистемы - 740 Гб.





#### Полезные ссылки:

[Привет, Minikube](https://kubernetes.io/ru/docs/tutorials/hello-minikube/#%D1%81%D0%BE%D0%B7%D0%B4%D0%B0%D0%BD%D0%B8%D0%B5-%D0%BA%D0%BB%D0%B0%D1%81%D1%82%D0%B5%D1%80%D0%B0-minikube)

[Deployments](https://kubernetes.io/docs/concepts/workloads/controllers/deployment/)

[Установка Minikube](https://kubernetes.io/ru/docs/tasks/tools/install-minikube/)

[Установка Kubernetes с помощью Minikube](https://kubernetes.io/ru/docs/setup/learning-environment/minikube/)

[Установка и настройка kubectl](https://kubernetes.io/ru/docs/tasks/tools/install-kubectl/)


[Пользователи и авторизация RBAC в Kubernetes](https://habr.com/ru/company/flant/blog/470503/)

[Азбука безопасности в Kubernetes: аутентификация, авторизация, аудит](https://habr.com/ru/company/flant/blog/468679/)

[Установка среды выполнения контейнера](https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/install-kubeadm/)

[кри-докерд](https://github.com/Mirantis/cri-dockerd)

[Migrate Docker Engine nodes from dockershim to cri-dockerd](https://kubernetes.io/docs/tasks/administer-cluster/migrating-from-dockershim/migrate-dockershim-dockerd/)

[CRI-O — альтернатива Docker для запуска контейнеров в Kubernetes](https://habr.com/ru/company/flant/blog/340010/)

[Использование авторизации RBAC](https://kubernetes.io/docs/reference/access-authn-authz/rbac/#referring-to-resources)

[Как изменить пользователей в kubectl?](https://stackoverflow.com/questions/61462892/how-to-change-users-in-kubectl)

[Руководство по Kubernetes, часть 2: создание кластера и работа с ним](https://habr.com/ru/company/ruvds/blog/438984/)

## Как оформить ДЗ?

Выполненное домашнее задание пришлите ссылкой на .md-файл в вашем репозитории.


