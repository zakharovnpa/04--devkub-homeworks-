## Лекция по теме "Команды для работы с Kubernetes"

Андрей
Копылов
1Андрей Копылов
TechLead
PremiumBonus
Андрей Копылов

### План занятия
1. Команда kubeadm
2. Команда kubectl
3. Итоги
4. Домашнее задание

### 3Главные команды
- kubeadm — серверная команда для настройки и управления кластером;
- kubectl — команда для управления отдельными ресурсами в рамках неймспейса или кластера.

### 4Команда kubeadm

### 5kubeadm init
Инициализация кластера
Полезные флаги:
* --apiserver-advertise-address — этот адрес будет слушать apiserver;
* --apiserver-bind-port — этот порт будет слушать apiserver;
* --control-plane-endpoint — потребуется для других мастеров;
* --cri-socket — сокет ContainerRuntime, по умолчанию ищет сам;
* --node-name — название ноды;
* --service-cidr — диапазон адресов для Сервисов.
* 
### 6kubeadm join
Служит для подключения к существующему кластеру

Полезные флаги:
* --control-plane — флаг указывает, что эта нода станет мастером;
* --token — токен от мастера для подключения;
* + все прошлые.

### 7kubeadm token

Управление токенами для подключения к кластеру
Полезные команды:
* create — создать новый токен;
* list — просмотр существующих токенов;
* delete — удаление токена.

### 8kubeadm conﬁg
Служит для просмотра конфигов инициализации кластера
Полезные команды:
* print init-defaults — просмотр конфига инициализации;
* images list — получение списка служебных конфигов;
* migrate — обновление конфигурации до новой версии.

### 9kubeadm upgrade
Удобная обёртка для обновления ноды кластера
Полезные команды:
* plan — проверяет доступные обновления;
* apply — применяет обновление на кластер;
* node — обновление отдельной ноды.

### 10kubeadm reset
**Сбрасывает конфиги на сервере до изначальных**
Помогает при ошибках конфигурирования и позволяет
начать всё сначала.

### 11kubeadm version
Просто выводит версию kubeadm в консоль :)
Полезна при установке и обновлении — уточняет версию, с
которой надо обновляться.

### 12Команда kubectl

### 13kubectl get
Получение списка ресурсов определённого типа
Полезные флаги:
* --all-namespaces — выводит ресурс из всех NS;
* --selector — применяется для фильтрации;
* --output — полезно при сохранении ресурса в файл
(например, для бекапа).

### 14kubectl describe
Получение детальной информации об объекте в кластере
Полезные флаги:
* --show-events — можно скрыть список событий.

### 15kubectl exec
ыполнение команды в контейнере отдельного пода
Полезные флаги:
* -с, --container — выбор отдельного контейнера в поде;
* -t, --tty — направляет ввод через терминал;
* -i, --stdin — позволяет направить stdin в контейнер.

### 16kubectl edit
Изменение ресурса напрямую в кластере. Вызовет
системный консольный редактор
Полезные флаги:
* --validate — позволяет отключить проверку конфига.

### 17kubectl logs
Получение логов от ресурса или конкретного контейнера
в поде
Полезные флаги:
* --all-containers — получение логов от всех контейнеров в поде сразу;
* -f, --follow — позволяет следить за логами в реальном времени.

### 18kubectl apply / delete
Создание и удаление ресурсов. Обычно применяются с файлами
Полезные флаги:
* -f — указывается файл с ресурсами для применения;
* --grace-period — можно задать таймаут для действия.

### 19kubectl cordon / uncordon / drain
Манипуляции с нодами. Исключение ноды из планирования,
возврат в планировщик и установка режима обслуживания
Полезные флаги:
* --ignore-daemosets(drain) — игнорирует поды демонов,
позволяя им оставаться и работать на ноде.

### 20kubectl port-forward      -00:21:17
Проксирование трафика до выбранного ресурса
Полезные флаги:
* --address — можно указать, какой адрес должен слушать
локально.

Если kubctl установлен на локальной машине то с помощью этой команды можно сделать прокси до нашего кубернетиса,
который может быть недоступен извне и отправлять запросы с нашему поду.

### 21kubectl label, kubectl annotate      -00:22:33
Управление метками и аннотациями ресурсов
Полезные флаги:
* list — вместо изменения выводит список текущих меток/аннотаций для ресурса.

На основе label можно делать фильтрацию. Можно сделать фильтр моего какого-то ресурса. 
Annotate - это для создания аннотации для ресурса и может использоваться как признак для какого-то действия.

### 22kubectl conﬁg     -00:24:27
Управление локальным конфиг-файлом
Полезные команды:
- current-context — получение текущего кластера/пользователя для команд;
- get-contexts — вывод списка доступных контекстов;
- use-context — изменение текущего контекста на указанный.

Это файл в котором описаны контексты, пользователи, файлы. И этот контекст можно переулючать и выбрать тот контекст который нужен сейчас.

### 23Kubernetes Dashboard      -00:25:30
![commands_01](/12-kubernetes-02-commands/Files/commands_01.png)

Позволяет видеть ресурсы кластера. Но некоторые вещи можно быстрее сделат и посмотреть с kubectl.
Есть другой ресурс - lens/Он ставится на нашу машину и является аналогом дашборда кубера. Там можно переключаться между контекстами.
* k9s - консольная утилита для тех же задач. Он использует UI.

### 24Итоги
Сегодня мы изучили:
- команду kubeadm;
- команду kubectl.
И узнали про:
- kubernetes dashboard.

### Практическая часть лекции   -00:29:05

### 25Домашнее задание
Давайте посмотрим ваше домашнее задание.
- Вопросы по домашней работе задавайте в чате мессенджера
Slack.
- Задачи можно сдавать по частям.
- Зачёт по домашней работе проставляется после того, как приняты
все задачи.

### 26Задавайте вопросы и
пишите отзыв о лекции!
Андрей Копылов
Андрей Копылов
27
